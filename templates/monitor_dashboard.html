<!DOCTYPE html>
<html>
<head>
    <title>{{ trading_symbol }} Trading Monitor Dashboard</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/monitor_dashboard.css') }}">
</head>
<body>
    <div class="header">
        <h1>üîç {{ trading_symbol }} Trading Monitor Dashboard</h1>
        <div class="controls">
            <button class="btn btn-primary" onclick="startMonitoring()">Start Monitoring</button>
            <button class="btn btn-danger" onclick="stopMonitoring()">Stop Monitoring</button>
            <button class="btn btn-success" onclick="checkNow()">Check Now</button>
        </div>
    </div>
    
    <div class="status-bar">
        <div class="status-item">
            <div class="status-indicator" id="status-indicator"></div>
            <span id="monitoring-status">Stopped</span>
        </div>
        <div class="status-item">
            <span>Last Update: </span>
            <span id="last-update">Never</span>
        </div>
        <div class="status-item">
            <span>Checks: </span>
            <span id="check-count">0</span>
        </div>
        <div class="status-item">
            <span>Signals: </span>
            <span id="signal-count">0</span>
        </div>
    </div>
    
    <div class="main-grid">
        <!-- Price Card -->
        <div class="card">
            <h3>üí∞ Current Price</h3>
            <div class="price-display" id="current-price">$0.00</div>
            <div class="metric">
                <span>EMA20 (1m):</span>
                <span class="metric-value" id="ema20">$0.00</span>
            </div>
            <div class="metric">
                <span>EMA50 (1m):</span>
                <span class="metric-value" id="ema50">$0.00</span>
            </div>
            <div class="metric">
                <span>vs EMA20:</span>
                <span class="metric-value" id="price-vs-ema20">0.00%</span>
            </div>
            <div class="metric">
                <span>MACD:</span>
                <span class="metric-value" id="macd">0.000</span>
            </div>
        </div>
        
        <!-- RSI Card -->
        <div class="card">
            <h3>üìä RSI Indicators</h3>
            <div class="metric">
                <span>RSI(7):</span>
                <span class="metric-value" id="rsi7">0.0</span>
            </div>
            <div class="rsi-gauge">
                <div class="rsi-arc"></div>
                <div class="rsi-needle" id="rsi7-needle"></div>
            </div>
            <div class="metric">
                <span>RSI(14):</span>
                <span class="metric-value" id="rsi14">0.0</span>
            </div>
            <div style="font-size: 0.7em; color: #9ca3af; margin-top: 6px;">
                <div>Oversold: &lt; 20 | Overbought: &gt; 80</div>
            </div>
        </div>
        
        <!-- Signal Card -->
        <div class="card signal-card">
            <h3>üéØ Trading Signal</h3>
            <div class="signal-status signal-hold" id="signal-status">HOLD</div>
            <div class="metric">
                <span>Confidence:</span>
                <span class="metric-value" id="confidence">0%</span>
            </div>
            <div class="confidence-bar">
                <div class="confidence-fill" id="confidence-bar" style="width: 0%"></div>
            </div>
            <div class="metric">
                <span>Strength:</span>
                <span class="metric-value" id="strength">0/100</span>
            </div>
            <div class="metric">
                <span>Validity:</span>
                <span class="metric-value" id="validity">0 hours</span>
            </div>
        </div>
    </div>
    
    <!-- Intraday Series Analysis -->
    <div class="card" id="intraday-analysis-card" style="margin: 0 12px;">
        <h3>üìä Intraday Analysis (Last 10 Minutes)</h3>
        <div class="analysis-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div class="analysis-section">
                <h4>üí∞ Price Movement</h4>
                <div class="series-container">
                    <div class="metric">
                        <span>Mid Prices:</span>
                        <div id="price-series" class="series-data">Loading...</div>
                    </div>
                    <div class="metric">
                        <span>Price Trend:</span>
                        <span id="price-trend" class="trend-indicator">-</span>
                    </div>
                </div>
                
                <h4>üìà EMA20 Evolution</h4>
                <div class="series-container">
                    <div class="metric">
                        <span>EMA20 Series:</span>
                        <div id="ema20-series" class="series-data">Loading...</div>
                    </div>
                    <div class="metric">
                        <span>EMA Trend:</span>
                        <span id="ema-trend" class="trend-indicator">-</span>
                    </div>
                </div>
            </div>
            
            <div class="analysis-section">
                <h4>üìä Technical Indicators</h4>
                <div class="series-container">
                    <div class="metric">
                        <span>MACD Series:</span>
                        <div id="macd-series" class="series-data">Loading...</div>
                    </div>
                    <div class="metric">
                        <span>RSI(7) Series:</span>
                        <div id="rsi7-series" class="series-data">Loading...</div>
                    </div>
                    <div class="metric">
                        <span>RSI(14) Series:</span>
                        <div id="rsi14-series" class="series-data">Loading...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="longer-term-context">
            <h4>üîç 4-Hour Context Analysis</h4>
            
            <!-- EMA Analysis -->
            <div class="context-section">
                <h5>üìà EMA Indicators</h5>
                <div class="context-grid-2">
                    <div class="context-metric">
                        <span>20-Period EMA:</span>
                        <span id="ema20-4h">-</span>
                    </div>
                    <div class="context-metric">
                        <span>50-Period EMA:</span>
                        <span id="ema50-4h">-</span>
                    </div>
                </div>
                <div class="context-metric">
                    <span>Position vs EMAs:</span>
                    <span id="position-4h-emas" class="trend-indicator">-</span>
                </div>
            </div>

            <!-- ATR & Volume Analysis -->
            <div class="context-section">
                <h5>üìä Volatility & Volume</h5>
                <div class="context-grid-2">
                    <div class="context-metric">
                        <span>3-Period ATR:</span>
                        <span id="atr3-4h">-</span>
                    </div>
                    <div class="context-metric">
                        <span>14-Period ATR:</span>
                        <span id="atr14-4h">-</span>
                    </div>
                </div>
                <div class="context-grid-2">
                    <div class="context-metric">
                        <span>Current Volume:</span>
                        <span id="current-volume">-</span>
                    </div>
                    <div class="context-metric">
                        <span>Average Volume:</span>
                        <span id="average-volume">-</span>
                    </div>
                </div>
                <div class="context-metric">
                    <span>Volume Ratio:</span>
                    <span id="volume-ratio" class="trend-indicator">-</span>
                </div>
            </div>

            <!-- MACD Series -->
            <div class="context-section">
                <h5>üìâ MACD Series (Last 10)</h5>
                <div class="series-container">
                    <div id="macd-4h-series" class="series-data">Loading...</div>
                    <div class="context-metric">
                        <span>MACD Trend:</span>
                        <span id="macd-4h-trend" class="trend-indicator">-</span>
                    </div>
                </div>
            </div>

            <!-- RSI Series -->
            <div class="context-section">
                <h5>üìà RSI(14) Series (Last 10)</h5>
                <div class="series-container">
                    <div id="rsi14-4h-series" class="series-data">Loading...</div>
                    <div class="context-metric">
                        <span>Current RSI(14):</span>
                        <span id="rsi14-4h">-</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="confidence-analysis">
            <h4>üéØ Confidence Factors</h4>
            <div id="confidence-factors" class="confidence-list">
                <div class="confidence-item">Analyzing market conditions...</div>
            </div>
        </div>
    </div>

    <!-- Trade Levels (only visible when signal active) -->
    <div class="card trade-levels-hidden" id="trade-levels-card">
        <h3>üí∞ Trade Levels</h3>
        <div class="trade-levels">
            <div class="metric">
                <span>Entry Price:</span>
                <span class="metric-value" id="entry-price">-</span>
            </div>
            <div class="metric">
                <span>Stop Loss:</span>
                <span class="metric-value" id="stop-loss">-</span>
            </div>
            <div class="metric">
                <span>Take Profit 1:</span>
                <span class="metric-value" id="tp1">- (R/R: <span id="rr1">0:0</span>)</span>
            </div>
            <div class="metric">
                <span>Take Profit 2:</span>
                <span class="metric-value" id="tp2">- (R/R: <span id="rr2">0:0</span>)</span>
            </div>
            <div class="metric">
                <span>Take Profit 3:</span>
                <span class="metric-value" id="tp3">- (R/R: <span id="rr3">0:0</span>)</span>
            </div>
            <div class="metric">
                <span>Position Size:</span>
                <span class="metric-value" id="position-size">0%</span>
            </div>
            <div class="metric">
                <span>Risk Amount:</span>
                <span class="metric-value" id="risk-amount">$0</span>
            </div>
        </div>
        
        <div class="signal-factors" id="signal-factors-container">
            <h4>üéØ Signal Factors:</h4>
            <ul id="signal-factors"></ul>
        </div>
    </div>
    
    <div class="bottom-grid">
        <!-- Monitoring Log -->
        <div class="log-container">
            <h3>üìã Monitoring Log</h3>
            <div id="monitoring-log">
                <div class="log-entry info">
                    <div class="log-time">--:--:--</div>
                    <div>Waiting for monitoring to start...</div>
                </div>
            </div>
        </div>
        
        <!-- Signal History -->
        <div class="card">
            <h3>üìà Recent Signals</h3>
            <div id="signal-history">
                <div class="no-signals-placeholder">
                    No signals detected yet
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/monitor_dashboard.js') }}"></script>
</body>
</html>