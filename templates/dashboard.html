<!DOCTYPE html>
<html class="dark" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>SolSignals - Trading Dashboard</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>

<!-- FontAwesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- Dashboard specific styles -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">

<!-- Chart.js for trading charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

<script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#13a4ec",
            "background-light": "#f6f7f8",
            "background-dark": "#101c22",
            "crypto-green": "#10b981",
            "crypto-red": "#ef4444", 
            "crypto-blue": "#3b82f6",
            "crypto-purple": "#8b5cf6",
            "text-muted": "#9ca3af",
            "dark-border": "#374151"
          },
          fontFamily: {
            "display": ["Space Grotesk", "sans-serif"]
          },
          borderRadius: {
            "DEFAULT": "0.25rem",
            "lg": "0.5rem",
            "xl": "0.75rem",
            "full": "9999px"
          },
        },
      },
    }
</script>

</head>
<body>
<div class="relative flex h-auto min-h-screen w-full flex-col bg-background-light dark:bg-background-dark group/design-root overflow-x-hidden font-display">
<div class="layout-container flex h-full grow flex-col">
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-white/10 px-10 py-3">
<div class="flex items-center gap-4 text-white">
<div class="w-8 h-8 text-primary">
<svg fill="none" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
<path d="M24 45.8096C19.6865 45.8096 15.4698 44.5305 11.8832 42.134C8.29667 39.7376 5.50128 36.3314 3.85056 32.3462C2.19985 28.361 1.76794 23.9758 2.60947 19.7452C3.451 15.5145 5.52816 11.6284 8.57829 8.5783C11.6284 5.52817 15.5145 3.45101 19.7452 2.60948C23.9758 1.76795 28.361 2.19986 32.3462 3.85057C36.3314 5.50129 39.7376 8.29668 42.134 11.8833C44.5305 15.4698 45.8096 19.6865 45.8096 24L24 24L24 45.8096Z" fill="currentColor"></path>
</svg>
</div>
<h2 class="text-white text-xl font-bold leading-tight tracking-[-0.015em]">SolSignals</h2>
</div>
<div class="flex flex-1 justify-end gap-8">
<div class="flex items-center gap-9">
{% include 'navigation.html' %}
</div>
<div class="flex items-center gap-4">
<button class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 bg-white/5 hover:bg-white/10 text-white gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5">
<span class="material-symbols-outlined text-white text-xl">account_circle</span>
</button>
<div class="flex items-center gap-2">
<div class="w-2 h-2 bg-green-500 rounded-full"></div>
<span class="text-white text-sm font-medium">{{ data.exchange }}</span>
</div>
</div>
</div>
</header>
<main class="px-10 py-5">
<div class="flex flex-col max-w-[1200px] mx-auto flex-1">
<div class="flex flex-wrap justify-between items-center gap-4 p-4">
<p class="text-white text-4xl font-black leading-tight tracking-[-0.033em] min-w-72">Trading Signal Dashboard</p>
<div class="text-white/70 text-sm">
<p>Symbol: <span class="text-primary font-semibold">{{ data.symbol }}</span></p>
<p>Status: <span class="text-green-400">{{ data.status }}</span></p>
</div>
</div>

<!-- Main Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
<div class="bg-white/5 border border-white/10 rounded-lg p-6">
<div class="flex items-center justify-between">
<div>
<p class="text-white/70 text-sm font-medium">Current Price</p>
<p class="text-white text-2xl font-bold">${{ "%.4f"|format(data.price) }}</p>
</div>
<div class="w-12 h-12 bg-primary/20 rounded-lg flex items-center justify-center">
<span class="material-symbols-outlined text-primary text-2xl">attach_money</span>
</div>
</div>
</div>

<div class="bg-white/5 border border-white/10 rounded-lg p-6">
<div class="flex items-center justify-between">
<div>
<p class="text-white/70 text-sm font-medium">EMA {{ data.ema_period }}</p>
<p class="text-white text-2xl font-bold">${{ "%.4f"|format(data.ema) }}</p>
</div>
<div class="w-12 h-12 bg-purple-500/20 rounded-lg flex items-center justify-center">
<span class="material-symbols-outlined text-purple-400 text-2xl">trending_up</span>
</div>
</div>
</div>

<div class="bg-white/5 border border-white/10 rounded-lg p-6">
<div class="flex items-center justify-between">
<div>
<p class="text-white/70 text-sm font-medium">Gap</p>
<p class="text-white text-2xl font-bold {{ 'text-green-400' if data.gap > 0 else 'text-red-400' }}">${{ "%.4f"|format(data.gap) }}</p>
</div>
<div class="w-12 h-12 bg-{{ 'green' if data.gap > 0 else 'red' }}-500/20 rounded-lg flex items-center justify-center">
<span class="material-symbols-outlined text-{{ 'green' if data.gap > 0 else 'red' }}-400 text-2xl">{{ 'north' if data.gap > 0 else 'south' }}</span>
</div>
</div>
</div>

<div class="bg-white/5 border border-white/10 rounded-lg p-6">
<div class="flex items-center justify-between">
<div>
<p class="text-white/70 text-sm font-medium">Signal</p>
<p class="text-white text-lg font-bold">
{% if data.within_threshold %}
<span class="text-green-400">üö® ACTIVE</span>
{% else %}
<span class="text-gray-400">Monitoring</span>
{% endif %}
</p>
</div>
<div class="w-12 h-12 bg-{{ 'green' if data.within_threshold else 'gray' }}-500/20 rounded-lg flex items-center justify-center">
<span class="material-symbols-outlined text-{{ 'green' if data.within_threshold else 'gray' }}-400 text-2xl">{{ 'notifications_active' if data.within_threshold else 'notifications' }}</span>
</div>
</div>
</div>
</div>

<!-- Charts Section -->


<!-- Recent Signals Table -->
<div class="bg-white/5 border border-white/10 rounded-lg p-6">
<div class="flex items-center justify-between mb-4">
<h3 class="text-white text-lg font-semibold">Recent Trading Signals</h3>
<div class="flex items-center space-x-4">
<span id="signals-last-updated" class="text-xs text-white/50"></span>
<button class="text-primary hover:text-primary/80 text-sm font-medium" onclick="refreshSignals()">
<span class="material-symbols-outlined text-sm mr-1">refresh</span>Refresh
</button>
</div>
</div>
<div class="overflow-x-auto">
<table class="w-full">
<thead>
<tr class="border-b border-white/10">
<th class="text-left text-white/70 text-sm font-medium py-3">Time</th>
<th class="text-left text-white/70 text-sm font-medium py-3">Signal</th>
<th class="text-left text-white/70 text-sm font-medium py-3">Price</th>
<th class="text-left text-white/70 text-sm font-medium py-3">EMA</th>
<th class="text-left text-white/70 text-sm font-medium py-3">Gap</th>
<th class="text-left text-white/70 text-sm font-medium py-3">Status</th>
</tr>
</thead>
<tbody id="signals-table">
<!-- Signals will be loaded here via JavaScript -->
</tbody>
</table>
</div>
</div>
</div>
</main>
</div>
</div>

<script>

// Initialize dashboard data
const dashboardData = {
    symbol: '{{ data.symbol }}',
    exchange: '{{ data.exchange }}',
    price: {{ data.price }},
    ema: {{ data.ema }},
    gap: {{ data.gap }},
    timestamp: '{{ data.timestamp }}',
    historical_data: {{ data.historical_data | tojson if data.historical_data else '[]' }}
};

// Initialize charts
let priceChart, gapChart;

function initCharts() {
    // Price & EMA Chart
    const priceCtx = document.getElementById('priceChart');
    if (priceCtx) {
        priceChart = new Chart(priceCtx, {
            type: 'line',
            data: {
                labels: dashboardData.historical_data.map(d => new Date(d.timestamp).toLocaleTimeString()),
                datasets: [
                    {
                        label: 'Price',
                        data: dashboardData.historical_data.map(d => d.price),
                        borderColor: '#13a4ec',
                        backgroundColor: 'rgba(19, 164, 236, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'EMA',
                        data: dashboardData.historical_data.map(d => d.ema),
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        grid: { color: 'rgba(255,255,255,0.1)' },
                        ticks: { color: 'rgba(255,255,255,0.7)' }
                    },
                    x: {
                        grid: { color: 'rgba(255,255,255,0.1)' },
                        ticks: { color: 'rgba(255,255,255,0.7)' }
                    }
                },
                plugins: {
                    legend: {
                        labels: { color: 'rgba(255,255,255,0.9)' }
                    }
                }
            }
        });
    }

    // Gap Chart
    const gapCtx = document.getElementById('gapChart');
    if (gapCtx) {
        gapChart = new Chart(gapCtx, {
            type: 'bar',
            data: {
                labels: dashboardData.historical_data.map(d => new Date(d.timestamp).toLocaleTimeString()),
                datasets: [{
                    label: 'Gap (Price - EMA)',
                    data: dashboardData.historical_data.map(d => d.gap),
                    backgroundColor: dashboardData.historical_data.map(d => 
                        d.gap > 0 ? 'rgba(16, 185, 129, 0.8)' : 'rgba(239, 68, 68, 0.8)'
                    )
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        grid: { color: 'rgba(255,255,255,0.1)' },
                        ticks: { color: 'rgba(255,255,255,0.7)' }
                    },
                    x: {
                        grid: { color: 'rgba(255,255,255,0.1)' },
                        ticks: { color: 'rgba(255,255,255,0.7)' }
                    }
                },
                plugins: {
                    legend: {
                        labels: { color: 'rgba(255,255,255,0.9)' }
                    }
                }
            }
        });
    }
}

// Load recent signals
async function loadSignals() {
    try {
        // Show loading indicator if table exists
        const tbody = document.getElementById('signals-table');
        if (tbody) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" class="py-4 text-center text-white/60">
                        <span class="inline-flex items-center">
                            <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Refreshing signals...
                        </span>
                    </td>
                </tr>
            `;
        }
        
        const response = await fetch('/api/signals?limit=10');
        const signals = await response.json();
        
        if (tbody && signals.length > 0) {
            tbody.innerHTML = signals.map(signal => `
                <tr class="border-b border-white/5 hover:bg-white/5">
                    <td class="py-3 text-white/80 text-sm">${new Date(signal.timestamp).toLocaleString()}</td>
                    <td class="py-3">
                        <span class="px-2 py-1 rounded text-xs font-semibold 
                        ${signal.signal_type === 'BUY' ? 'bg-green-500/20 text-green-400' : 
                          signal.signal_type === 'SELL' ? 'bg-red-500/20 text-red-400' : 
                          'bg-gray-500/20 text-gray-400'}">
                        ${signal.signal_type || 'SIGNAL'}
                        </span>
                    </td>
                    <td class="py-3 text-white text-sm">$${signal.price ? signal.price.toFixed(4) : '0.0000'}</td>
                    <td class="py-3 text-white/80 text-sm">$${signal.ema_value ? signal.ema_value.toFixed(4) : '0.0000'}</td>
                    <td class="py-3 text-sm ${signal.gap > 0 ? 'text-green-400' : 'text-red-400'}">
                        $${signal.gap ? signal.gap.toFixed(4) : '0.0000'}
                    </td>
                    <td class="py-3 text-white/70 text-sm">${signal.message || 'Active'}</td>
                </tr>
            `).join('');
            
            // Update last updated timestamp
            const lastUpdatedElement = document.getElementById('signals-last-updated');
            if (lastUpdatedElement) {
                lastUpdatedElement.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
            }
        } else if (tbody) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" class="py-8 text-center text-white/60">
                        No trading signals found. Signals will appear when conditions are met.
                    </td>
                </tr>
            `;
        }
    } catch (error) {
        console.error('Error loading signals:', error);
        const tbody = document.getElementById('signals-table');
        if (tbody) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" class="py-8 text-center text-red-400">
                        Error loading signals. Please refresh the page.
                    </td>
                </tr>
            `;
        }
    }
}

// Refresh signals
function refreshSignals() {
    loadSignals();
}

// Auto-refresh data every 30 seconds
function refreshData() {
    // Refresh signals without reloading the page
    loadSignals();
    
    // You can add other refresh functions here if needed
    // For now, we'll just refresh signals to avoid full page reload
}

// Initialize everything when page loads
document.addEventListener('DOMContentLoaded', function() {
    initCharts();
    loadSignals();
    
    // Auto-refresh signals every 30 seconds
    setInterval(refreshData, 30000);
    
    // Also refresh signals every 15 seconds for more real-time updates
    setInterval(loadSignals, 15000);
});
</script>

</body>
</html>

    <div class="max-w-7xl mx-auto px-6 py-6">
        <!-- Main Content Views -->
        
        <!-- Dashboard View -->
        <div id="view-dashboard" class="main-view">
            <!-- System Status -->
            <div class="dark-card rounded-lg p-4 mb-6">
                <h3 class="text-lg font-semibold mb-2">System Status</h3>
                <p class="text-text-muted" id="status-text">{{ data.status }}</p>
            </div>

        <!-- Key Metrics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <!-- Current Price -->
            <div class="metric-card rounded-lg p-6">
                <div class="text-sm text-text-muted mb-2">Current Price</div>
                <div class="text-2xl font-bold text-white" id="current-price">
                    {% if data.price and data.price > 0 %}
                        ${{ "%.4f"|format(data.price) }}
                    {% else %}
                        <span class="text-gray-500">---.----</span>
                    {% endif %}
                </div>
                <div class="text-xs text-text-muted mt-1">{{ data.symbol or "SOL/USDT" }}</div>
            </div>

            <!-- EMA Value -->
            <div class="metric-card rounded-lg p-6">
                <div class="text-sm text-text-muted mb-2">EMA ({{ data.ema_period or 50 }})</div>
                <div class="text-2xl font-bold text-white" id="ema-value">
                    {% if data.ema and data.ema > 0 %}
                        ${{ "%.4f"|format(data.ema) }}
                    {% else %}
                        <span class="text-gray-500">---.----</span>
                    {% endif %}
                </div>
                <div class="text-xs text-text-muted mt-1">Exponential Moving Average</div>
            </div>

            <!-- Price Gap -->
            <div class="metric-card rounded-lg p-6">
                <div class="text-sm text-text-muted mb-2">Price Gap</div>
                <div class="text-2xl font-bold text-white" id="price-gap">
                    {% if data.gap is defined and data.gap != 0 %}
                        {% if data.gap >= 0 %}
                            <span class="text-crypto-green">+${{ "%.4f"|format(data.gap) }}</span>
                        {% else %}
                            <span class="text-crypto-red">-${{ "%.4f"|format(-data.gap) }}</span>
                        {% endif %}
                    {% else %}
                        <span class="text-gray-500">---.----</span>
                    {% endif %}
                </div>
                <div class="text-xs text-text-muted mt-1">
                    {% if data.gap is defined and data.gap != 0 %}
                        {% if data.gap >= 0 %}Above EMA{% else %}Below EMA{% endif %}
                    {% else %}
                        Waiting for data...
                    {% endif %}
                </div>
            </div>

            <!-- Signal Status -->
            <div class="metric-card rounded-lg p-6" id="signal-card">
                <div class="text-sm text-text-muted mb-2">Trading Signal</div>
                <div class="text-2xl font-bold" id="signal-status">
                    {% if data.signal_type and data.signal_type != 'HOLD' %}
                        {% if data.signal_type == 'STRONG_BUY' %}
                            <span class="text-green-400">üöÄ STRONG BUY</span>
                        {% elif data.signal_type == 'BUY' %}
                            <span class="text-crypto-green">üìà BUY</span>
                        {% elif data.signal_type == 'STRONG_SELL' %}
                            <span class="text-red-400">üîª STRONG SELL</span>
                        {% elif data.signal_type == 'SELL' %}
                            <span class="text-crypto-red">üìâ SELL</span>
                        {% else %}
                            <span class="text-text-muted">‚è∏Ô∏è HOLD</span>
                        {% endif %}
                    {% else %}
                        <span class="text-text-muted">‚è∏Ô∏è HOLD</span>
                    {% endif %}
                </div>
                <div class="text-xs text-text-muted mt-1" id="signal-strength">
                    {% if data.signal_strength and data.signal_strength > 0 %}
                        Confidence: {{ "%.0f"|format(data.signal_strength * 100) }}%
                    {% else %}
                        Waiting for signal
                    {% endif %}
                </div>
            </div>
        </div>

       
    
        <!-- Signal Details -->
        {% if data.signal_reason %}
        <div class="dark-card rounded-lg p-4 mb-6">
            <h3 class="text-lg font-semibold mb-2 flex items-center">
                <i class="fas fa-info-circle mr-2 text-crypto-blue"></i>
                Signal Analysis
            </h3>
            <p class="text-sm text-gray-300" id="signal-reason">{{ data.signal_reason }}</p>
        </div>
        {% endif %}

      
           

        </div>


        
       
    </div>

    <!-- Essential JavaScript functions -->
    <script>
    // Missing function implementations to fix console errors
    
    // Tab switching function
    function switchTab(tabName) {
        // Hide all tab contents
        const contents = document.querySelectorAll('.tab-content');
        contents.forEach(content => content.classList.add('hidden'));
        
        // Remove active class from all tab buttons
        const buttons = document.querySelectorAll('.tab-button');
        buttons.forEach(btn => btn.classList.remove('active', 'bg-crypto-blue', 'text-white'));
        buttons.forEach(btn => btn.classList.add('text-gray-400'));
        
        // Show selected tab content
        const selectedContent = document.getElementById(`content-${tabName}`);
        if (selectedContent) selectedContent.classList.remove('hidden');
        
        // Add active class to selected button
        const selectedButton = document.getElementById(`tab-${tabName}`);
        if (selectedButton) {
            selectedButton.classList.add('active', 'bg-crypto-blue', 'text-white');
            selectedButton.classList.remove('text-gray-400');
        }
    }
    
    // Chart zoom functions (placeholder implementations)
    function zoomIn() { console.log('Zoom in functionality would be implemented here'); }
    function zoomOut() { console.log('Zoom out functionality would be implemented here'); }
    function resetZoom() { console.log('Reset zoom functionality would be implemented here'); }
    function zoomInLive() { console.log('Live zoom in functionality would be implemented here'); }
    function zoomOutLive() { console.log('Live zoom out functionality would be implemented here'); }
    function resetZoomLive() { console.log('Live reset zoom functionality would be implemented here'); }
    
    // Chart data update function
    function updateChartData(hours) {
        console.log(`Update chart data for ${hours} hours`);
        // This would update the chart with data for the specified time range
    }
    
    // Live updates toggle
    function toggleLiveUpdates() {
        const toggle = document.getElementById('liveToggle');
        const icon = toggle.querySelector('i');
        
        if (toggle.classList.contains('text-crypto-green')) {
            toggle.classList.remove('text-crypto-green');
            toggle.classList.add('text-gray-400');
            icon.classList.remove('fa-pause');
            icon.classList.add('fa-play');
            toggle.innerHTML = '<i class="fas fa-play mr-1"></i>Paused';
        } else {
            toggle.classList.remove('text-gray-400');
            toggle.classList.add('text-crypto-green');
            icon.classList.remove('fa-play');
            icon.classList.add('fa-pause');
            toggle.innerHTML = '<i class="fas fa-pause mr-1"></i>Live';
        }
    }
    
    // Clear live data
    function clearLiveData() {
        console.log('Clear live data functionality would be implemented here');
    }
    
    // Alert management functions
    function createAlert() {
        const condition = document.getElementById('alert-condition')?.value;
        const threshold = document.getElementById('alert-threshold')?.value;
        const notification = document.getElementById('alert-notification')?.value;
        
        if (!condition || !threshold || !notification) {
            alert('Please fill in all alert fields');
            return;
        }
        
        console.log('Creating alert:', { condition, threshold, notification });
        // Implementation would create the alert via API
    }
    
    function refreshAlerts() {
        console.log('Refreshing alerts...');
        // Implementation would reload alerts from API
    }
    
    // Scanner functions
    function toggleBreakoutScanner() {
        const btn = document.getElementById('scanner-toggle-btn') || document.getElementById('scanner-toggle');
        const icon = btn?.querySelector('i');
        
        if (btn?.textContent.includes('Start')) {
            btn.innerHTML = '<i class="fas fa-stop mr-2"></i>Stop Scanner';
            btn.classList.remove('bg-blue-600', 'hover:bg-blue-700', 'bg-green-600', 'hover:bg-green-700');
            btn.classList.add('bg-red-600', 'hover:bg-red-700');
            console.log('Scanner started');
        } else {
            btn.innerHTML = '<i class="fas fa-play mr-2"></i>Start Scanner';
            btn.classList.remove('bg-red-600', 'hover:bg-red-700');
            btn.classList.add('bg-blue-600', 'hover:bg-blue-700');
            console.log('Scanner stopped');
        }
    }
    
    // Database cleanup function
    function manualCleanup() {
        if (confirm('Are you sure you want to cleanup old database records?')) {
            console.log('Manual database cleanup initiated');
            // Implementation would call cleanup API
        }
    }
    </script>

    <!-- Custom Dashboard JavaScript -->
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>